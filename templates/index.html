{% extends "base.html" %}

{% load static %}
{% block header %}
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{% block title %}TrustBuySell{% endblock %}</title>
<link rel="stylesheet" href="{% static 'css/main.css' %}">
{% include "header.html"%}
{% endblock %}

{% block content %}
<section class="hero" aria-label="Hero">
  <div class="hero-card">
    {% if hero %}
    <div class="hero-media" style="background-image:url('{{ hero.image.url }}')"></div>
    {% endif %}
    <div class="hero-content">
      <h1>Buy & Sell in Adamawa — Fast • Secure • Reliable</h1>
      <p>Reach more customers in your community. Start selling today on TrustBuySell.</p>
      <div class="hero-actions">
        <a class="btn btn-accent" href="{% url 'register' %}">Register & Sell</a>
        <a class="btn ghost" href="#featuredA">Shop Featured</a>
      </div>
    </div>
  </div>

  <div class="chip-row" id="catsA">
    {% for category in categories %}
      <a class="chip" href="{% url 'category_products' category.id %}"
        data-cat="{{ category.name|default:'' }}">{{ category.name }}</a>
    {% empty %}
      <span class="chip">No categories yet</span>
    {% endfor %}
  </div>
</section>

<main class="section">
  <div class="title">
    <h2>Recent Products</h2><span class="muted">Top picks from local sellers</span>
  </div>

  <div id="featuredA" class="grid" aria-live="polite">
    {% for product in allproducts %}
    <article class="card">
      <a class="btn btn-outline" href="{% url 'product_detail' product.slug %}">
        <div class="media">

          {% if product.images.all %}
            <img loading="lazy" src="{{ product.images.first.image.url }}" alt="{{ product.name }}">
          {% else %}
            <img loading="lazy" src="{% static 'img/placeholder.png' %}" alt="No image available">
          {% endif %}

        </div>
      </a>

      <div class="body">
        <div class="p-title">{{ product.name }}</div>
        <div class="muted">{{ product.seller.name }}</div>
        <div class="price">₦{{ product.discountedprice|floatformat:0 }}</div>

        <div class="actions">
          <a class="btn btn-accent" href="{% url 'add-to-cart' product.id %}">Add to Cart</a>
          <a class="btn btn-outline" href="{% url 'product_detail' product.slug %}">View</a>
        </div>
      </div>
    </article>
    {% empty %}
      <p class="muted">No recent products available at the moment.</p>
    {% endfor %}
  </div>

  <!-- Top Rated Products -->
  <div class="title" style="margin-top:32px;">
    <h2>⭐ Top Rated Products</h2>
    <span class="muted">Most loved by customers</span>
  </div>

  {% if top_rated %}
  <div id="topRated" class="grid">
    {% for product in top_rated %}
    <article class="card">
      <a class="btn btn-outline" href="{% url 'product_detail' product.slug %}">
        <div class="media">
          {% if product.images.first %}
            <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}">
          {% else %}
            <img src="{% static 'img/placeholder.png' %}" alt="No image">
          {% endif %}
        </div>
      </a>

      <div class="body">
        <div class="p-title">{{ product.name }}</div>
        <div class="price">₦{{ product.discountedprice|floatformat:0 }}</div>

        <p class="rating">★ {{ product.five_star_count }} five-star{{ product.five_star_count|pluralize }}</p>

        <div class="actions">
          <a class="btn btn-accent" href="{% url 'add-to-cart' product.id %}">Add to Cart</a>
          <a class="btn btn-outline" href="{% url 'product_detail' product.slug %}">View</a>
        </div>
      </div>
    </article>
    {% endfor %}
  </div>
  {% else %}
    <p class="muted">No top-rated products yet.</p>
  {% endif %}

  <a href="{% url 'top_rated' %}" class="btn btn-outline" style="margin-top:10px;">View All Top Rated Products</a>

  <section class="section" style="padding:0;margin-top:16px">
    <div class="title">
      <h2>What Sellers & Buyers Say</h2>
    </div>
    <div class="testimonials" aria-label="Testimonials">
      <div class="trow" id="trowA">
        <div class="t"><strong>Fatima (seller)</strong>
          <p class="muted">“My sales increased after I joined TrustBuySell — easy and local.”</p>
        </div>
        <div class="t"><strong>Ali (buyer)</strong>
          <p class="muted">“Fast delivery and good prices. I love supporting local stores.”</p>
        </div>
        <div class="t"><strong>Nura (seller)</strong>
          <p class="muted">“Smooth onboarding and payments. Great support from the team.”</p>
        </div>
      </div>
    </div>
  </section>
</main>
{% endblock %}
