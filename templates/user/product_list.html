{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Products Dashboard</title>
  <style>
    :root{
      --primary:#2563eb;
      --primary-600:#1d4ed8;
      --danger:#dc2626;
      --danger-600:#b91c1c;
      --muted:#64748b;
      --bg:#f8fafc;
      --card:#fff;
      --ring:rgba(0,0,0,.06);
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Roboto,Arial,sans-serif;background:var(--bg);margin:0;color:#0f172a}
    header{position:sticky;top:0;background:var(--primary);color:#fff;padding:14px 16px;display:flex;justify-content:space-between;align-items:center}
    header h1{margin:0;font-size:1.1rem}
    .btn{border:0;cursor:pointer;border-radius:10px;padding:10px 14px;font-weight:700;background:var(--primary);color:#fff}
    .btn:hover{background:var(--primary-600)}
    .btn-ghost{background:#fff;color:#1f2937}
    .btn-danger{background:var(--danger)}
    .btn-danger:hover{background:var(--danger-600)}
    .container{padding:16px}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 20px var(--ring)}
    th,td{padding:12px;text-align:left;border-bottom:1px solid #e5e7eb}
    th{background:#f1f5f9;text-transform:uppercase;font-size:12px}
    img.thumb{width:60px;height:60px;object-fit:cover;border-radius:6px}
    .status{padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .status.published{background:rgba(22,163,74,.12);color:#166534}
    .status.draft{background:rgba(245,158,11,.12);color:#a16207}
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:100}
    .modal{background:#fff;border-radius:12px;width:min(500px,90%);padding:20px;max-height:90vh;overflow:auto}
    .form{display:grid;gap:10px}
    input,select,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px}
    textarea{min-height:80px}
  </style>
</head>
<body>
  <header>
    <h1>Products Dashboard</h1>
    <div>
      <a class="btn-ghost btn" href="{% url 'addproductimage' %}">Manage Images</a>
      <a href="{% url 'add_product'%}"><button class="btn" >＋ Add Product</button></a>
    </div>
  </header>

  <div class="container">
    <table>
      <thead>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Category</th>
          <th>Price</th>
          <th>Status</th>
          <th>Updated</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr>
          <td>
            {% if product.product_image %}
              <img src="{{ product.product_image.image.url }}" class="thumb">
            {% else %}
              —
            {% endif %}
          </td>
          <td>{{ product.name }}</td>
          <td>{{ product.category.name }}</td>
          <td>₦{{ product.discountedprice|default:product.actualprice }}</td>
          <td><span class="status {{ product.status }}">{{ product.get_status_display }}</span></td>
          <td>{{ product.updated|date:"M d, Y" }}</td>
          <td>
            <a class="btn" href="{% url 'product_update' product.slug %}">Edit</a>
            <button class="btn btn-danger" onclick="openDeleteModal('{{ product.slug }}','{{ product.name|escapejs }}')">Delete</button>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="7" style="text-align:center;color:#64748b;">No products yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Add Product Modal -->
  <div class="backdrop" id="addBackdrop">
    <div class="modal">
      <h2>Add Product</h2>
      <form method="post" enctype="multipart/form-data" class="form">
        {% csrf_token %}
        <label>Name</label>
        <input type="text" name="name" required>

        <label>Category</label>
        <select name="category">
          {% for c in categories %}
          <option value="{{ c.id }}">{{ c.name }}</option>
          {% endfor %}
        </select>

        <label>Status</label>
        <select name="status">
          <option value="draft">Draft</option>
          <option value="published">Published</option>
        </select>

        <label>Stock</label>
        <input type="number" name="stock">

        <label>Actual Price</label>
        <input type="number" name="actualprice" step="0.01">

        <label>Discounted Price</label>
        <input type="number" name="discountedprice" step="0.01">

        <label>Description</label>
        <textarea name="description"></textarea>

        <label>Product Image</label>
        <input type="file" name="product_image" accept="image/*">

        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:10px;">
          <button type="button" class="btn-ghost btn" onclick="closeAddModal()">Cancel</button>
          <button type="submit" class="btn">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="backdrop" id="deleteBackdrop">
    <div class="modal">
      <h2 style="color:#dc2626;">Confirm Delete</h2>
      <p>Are you sure you want to delete <strong id="deleteName"></strong>?</p>
      <form method="post" id="deleteForm">
        {% csrf_token %}
        <div style="display:flex;gap:10px;justify-content:flex-end;">
          <button type="button" class="btn-ghost btn" onclick="closeDeleteModal()">Cancel</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const addBackdrop=document.getElementById('addBackdrop');
    const deleteBackdrop=document.getElementById('deleteBackdrop');
    const deleteForm=document.getElementById('deleteForm');
    const deleteName=document.getElementById('deleteName');

    document.getElementById('openAdd').onclick=()=>{addBackdrop.style.display='flex';};
    function closeAddModal(){addBackdrop.style.display='none';}

    function openDeleteModal(slug,name){
      deleteForm.action=`{% url 'product_delete' 'slug-placeholder' %}`.replace('slug-placeholder',slug);
      deleteName.textContent=name;
      deleteBackdrop.style.display='flex';
    }
    function closeDeleteModal(){deleteBackdrop.style.display='none';}

    [addBackdrop,deleteBackdrop].forEach(b=>b.addEventListener('click',e=>{if(e.target===b)b.style.display='none';}));
  </script>
</body>
</html>
